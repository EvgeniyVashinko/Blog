@model Article
@inject Blog.Domain.DataManager dataManager;
@inject UserManager<User> userManager
@inject SignInManager<User> SignInManager
@inject Microsoft.AspNetCore.Mvc.Localization.IViewLocalizer localizer

@{
    ViewData["Title"] = localizer["title"];
}

<section>
    <header class="main">
        <h1>@Model.Title</h1>
    </header>
    @if (Model.ImagePath != null)
    {
        <span class="image left"><img src="~/images/@Model.ImagePath" alt="" /></span>
    }


    @Html.Raw(Model.Text)

    <div class="row">
        <div class="col-9 col-12-medium">
            <ul class="icons">
                <li>
                    <strong>@Model.ArticleLikes.Count()</strong>
                </li>
                <li>
                    @*<a asp-controller="Blog" asp-action="ArticleLike" asp-route-id="@Model.Id" class="icon fa fa-thumbs-up" aria-hidden="true"></a>*@
                    <button id="likeButton"><i class="icon fa fa-thumbs-up" aria-hidden="true"></i></button>
                </li>
            </ul>
        </div>
        <div class="col-3 col-12-medium inner">
            <nav id="menu">
                <ul>
                    <li>
                        <span class="opener">@localizer["complain"]</span>
                        <vc:categories-list list="@dataManager.ReportCategories.GetReportCategoriesStringList()" select="false" contr="Article" actn="Report" id="@Model.Id"></vc:categories-list>
                    </li>
                </ul>
            </nav>
        </div>
    </div>


    @*<form asp-controller="Blog" asp-action="CreateComment">
            <input type="hidden" asp-for="Id" />
            <div>
                <textarea placeholder="Введите текст комментария" rows="6" name="tarea"></textarea>
            </div>
            <br />
            <div>
                <input type="submit" value="Отправить" class="primary" />
            </div>
        </form>*@

    @if (SignInManager.IsSignedIn(User))
    {
        <form>
            <input type="hidden" asp-for="@Model.Id" class="form-control" id="articleId" />
            <div class="form-group">
                <textarea class="form-control" placeholder="@localizer["comm"]" rows="6" id="content"></textarea>
            </div>
            <br />
            <div class="form-group">
                <input class="btn btn-primary" type="submit" value="@localizer["send"]" id="send" />
            </div>
        </form>
    }

    <br />
    <div id="comments">
        @if (ViewBag.Comments != null)
        {
            @foreach (Comment comment in ViewBag.Comments)
            {
                var uid = comment.UserId.ToString();
                var username = userManager.FindByIdAsync(uid).Result.UserName;
                <div class="box">
                    <a href=""><h4>@username</h4></a>
                    <p>@comment.Text</p>
                </div>
            }
        }
    </div>
    <script src="~/js/signalr/dist/browser/signalr.min.js"></script>
    <script src="~/js/sendComments.js"></script>
</section>

